<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>The Cabin in the City</title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_859455_eaq7v6w8ktj.css">
<meta name="generator" content="Hexo 4.2.1"></head>
<body>
<header class="header">
    <div class="header-inner">
        <div class="header-title">

        </div>
        <nav class="header-nav">
            
            <a href="/" class="header-nav-link" >
                Home
            </a>
            

            
            <a href="/archives" class="header-nav-link">
                Archives
            </a>
            

            
            <a href="/tags" class="header-nav-link">
                Tags
            </a>
            

            
            <a href="/about/" class="header-nav-link">
                About
            </a>
            
        </nav>
    </div>
</header>
<header class="mobile-header">
    <div class="mobile-nav">
        <div class="mobile-nav-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="mobile-nav-title">
            <a href="/" class="mobile-nav-title-link">Guo's Blog</a>
        </div>

    </div>
    <nav class="mobile-menu">
        <ul class="mobile-menu-list">
            <li class="mobile-menu-item">
                <i class="iconfont icon-home"></i>
                <a href="/" class="mobile-nav-link">Home</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-archive"></i>
                <a href="/archives" class="mobile-nav-link">Archives</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-tag"></i>
                <a href="/tags" class="mobile-nav-link">Tags</a>
            </li>
            <li class="mobile-menu-item">
                <i class="iconfont icon-about"></i>
                <a href="/about/" class="mobile-nav-link">About</a>
            </li>
        </ul>
    </nav>
</header>
<div class="main">
    <div class="content-inner">
        <div class="posts">
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/Linux/%E9%AB%98%E7%BA%A7%E6%96%87%E6%9C%AC%E5%91%BD%E4%BB%A4/">高级文本命令</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2020-06-06</span>
                
                <span class="post-category">
                    
                    <a class="category" href="/categories/Linux/">Linux</a>
                    
                </span>
                
            </div>
            <div class="post-content">
                
                    <h1 id="高级文本命令"><a href="#高级文本命令" class="headerlink" title="高级文本命令"></a>高级文本命令</h1><h4 id="1-sed-命令"><a href="#1-sed-命令" class="headerlink" title="1 sed  命令"></a>1 sed  命令</h4><h5 id="synopsis-基本用法"><a href="#synopsis-基本用法" class="headerlink" title="synopsis - 基本用法"></a><strong>synopsis - 基本用法</strong></h5><p>sed [OPTION]… {script-only-if-no-other-script} [input-file]..</p>
<h5 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h5><p><a href="https://www.cnblogs.com/theCambrian/p/3606214.html" target="_blank" rel="noopener">博客园  sed 的工作原理</a></p>
<p><code>man sed</code></p>
<h5 id="option"><a href="#option" class="headerlink" title="option"></a><strong>option</strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># suppress automatic printing of pattern space</span></span><br><span class="line"><span class="comment"># 关闭 pattern space 的自动打印，如果 command 中已经指定了 p, 可能就需要指定该选项</span></span><br><span class="line">-n, --quiet, --silent</span><br></pre></td></tr></table></figure>



<h5 id="script-command"><a href="#script-command" class="headerlink" title="script command"></a><strong>script command</strong></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">d      <span class="comment"># Delete pattern space.  Start next cycle.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy 即覆盖， append 即追加</span></span><br><span class="line">h H    <span class="comment"># Copy/append pattern space to hold space.</span></span><br><span class="line">g G    <span class="comment"># Copy/append hold space to pattern space.</span></span><br><span class="line">x      <span class="comment"># Exchange the contents of the hold and pattern spaces.</span></span><br><span class="line"></span><br><span class="line">n N    <span class="comment"># Read/append the next line of input into the pattern space.</span></span><br><span class="line">p      <span class="comment"># Print the current pattern space.</span></span><br><span class="line">P      <span class="comment"># Print up to the first embedded newline of the current pattern space.</span></span><br><span class="line"></span><br><span class="line">w filename <span class="comment"># Write the current pattern space to filename.</span></span><br><span class="line">W filename <span class="comment"># Write the first line of the current pattern space to filename.  This is a GNU extension.</span></span><br></pre></td></tr></table></figure>
<h5 id="examples"><a href="#examples" class="headerlink" title="examples"></a><strong>examples</strong></h5><ul>
<li>逆序打印文件行，等同于 <code>tac</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一行，只将 pattern space 中的内容 copy 到 hold space，再删除 pattern space，下一轮循环</span></span><br><span class="line"><span class="comment"># 接下来，每一行，将 hold space 的内容 append 到 pattern space，再删除 pattern space，下一轮循环</span></span><br><span class="line">sed <span class="string">'1&#123;h;d&#125;;G;h;$!d'</span> seq.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sed <span class="string">'1!G;h;$!d'</span> t.txt</span><br><span class="line"><span class="comment"># 1!G —— 只有第一行不执行G命令，将hold space中的内容append回到pattern space</span></span><br><span class="line"><span class="comment"># h —— 第一行都执行h命令，将pattern space中的内容拷贝到hold space中</span></span><br><span class="line"><span class="comment"># $!d —— 除了最后一行不执行d命令，其它行都执行d命令，删除当前行</span></span><br></pre></td></tr></table></figure>

<ul>
<li>指定要处理的行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印第一行，1 指定第一行</span></span><br><span class="line">sed  -n <span class="string">'1p'</span> seq.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印除了第一行的所有行</span></span><br><span class="line">sed -n <span class="string">'1!p'</span> seq.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印奇数行，如第 1 行，第 3 行，第 5 行...， 语义为，从第一行开始，每隔 2 行打印</span></span><br><span class="line">sed -n <span class="string">'1~2p'</span> seq.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印偶数行, 语义为每隔 2 行，打印</span></span><br><span class="line">sed -n <span class="string">'0~2p'</span> seq.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印第一行，以及后续连续的 5 行</span></span><br><span class="line">sed -n <span class="string">'1,+5p'</span> seq.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印第一行，直到第一次遇到行号是 2 的倍数的行，打印</span></span><br><span class="line">sed -n <span class="string">'1,~2p'</span> seq.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印最后一行</span></span><br><span class="line">sed -n <span class="string">'$p'</span> seq.txt </span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印</span></span><br><span class="line">sed -n <span class="string">'/regex/p'</span> seq.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># &amp; 代表匹配的内容</span></span><br><span class="line"><span class="built_in">echo</span> &#123;a..z&#125; | xargs -n 1 | sed <span class="string">"s/[a-z]/[&amp;]/g"</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>sed表达式通常用单引号来引用。不过也可以使用双引号。 shell会在调用sed前先扩展双引<br>号中的内容。如果想在sed表达式中使用变量，双引号就能派上用场了。</p>
</blockquote>
<h4 id="2-cut"><a href="#2-cut" class="headerlink" title="2 cut"></a>2 cut</h4><p>synopsis - 基本用法</p>
<p>cut OPTION  [FILE]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-d, --delimiter		<span class="comment"># 指定列分隔符</span></span><br><span class="line">-f, --fields		<span class="comment"># 制定要打印的列（不包含列分隔符的行同样会被打印，除非指定 -s）</span></span><br><span class="line">--complement		<span class="comment"># 打印指定之外的列、字符或字节（相当于取反）</span></span><br><span class="line">-output-delimiter	<span class="comment"># 指定打印时的列分隔符</span></span><br><span class="line">-z 					<span class="comment"># 行分隔符为 NUL， cut 是对一行进行切割的</span></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cut -d <span class="string">","</span> f 2,5 file		<span class="comment"># 打印第2列，第5列</span></span><br><span class="line">cut -d <span class="string">","</span> f 2-5 file		<span class="comment"># 打印第2列到第5列</span></span><br><span class="line">cut -d <span class="string">","</span> f 2-5 --complement file	<span class="comment"># 打印除了2-5列的其他列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 制定打印第几个字节、字符、列（区间）</span></span><br><span class="line"><span class="comment"># N-M 从第N个字节、字符或字段开始到行尾</span></span><br><span class="line"><span class="comment"># N-  从第N个字节、字符或字段开始到第M个（包括第M个在内）字节、字符或字段</span></span><br><span class="line"><span class="comment"># -M  从第1个字节、字符或字段开始到第M个（包括第M个在内）字节、字符或字段</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> &#123;a..z&#125; | cut -d <span class="string">" "</span> -f-4</span><br><span class="line"><span class="comment"># result: a b c d</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"4 3\x001 2"</span> | cut -z -d <span class="string">" "</span> --output-delimiter <span class="string">"#"</span> -f1,2</span><br></pre></td></tr></table></figure>





<h4 id="3-awk"><a href="#3-awk" class="headerlink" title="3 awk"></a>3 awk</h4><p>awk BEGIN{} PATTERN {} END{}</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># awk 的 pattern</span></span><br><span class="line">$ awk <span class="string">'NR &lt; 5'</span> <span class="comment"># 行号小于5的行</span></span><br><span class="line">$ awk <span class="string">'NR==1,NR==4'</span> <span class="comment"># 行号在1到5之间的行</span></span><br><span class="line">$ awk <span class="string">'/linux/'</span> <span class="comment"># 包含模式为linux的行（可以用正则表达式来指定模式）</span></span><br><span class="line">$ awk <span class="string">'!/linux/'</span> <span class="comment"># 不包含模式为linux的行</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F":" 'BEGIN&#123;OFS="#"&#125; &#123;print $1,$2&#125;'</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># awk可以调用命令并读取输出。把命令放入引号中，然后利用管道将命令输出传入getline：</span></span><br><span class="line">awk <span class="string">'BEGIN &#123;FS=":"&#125; &#123; "grep root /etc/passwd" | getline; \</span></span><br><span class="line"><span class="string">print $1,$6 &#125;'</span></span><br><span class="line"></span><br><span class="line">root /root</span><br></pre></td></tr></table></figure>



<h4 id="4-tr"><a href="#4-tr" class="headerlink" title="4 tr"></a>4 tr</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> alnum：字母和数字。</span><br><span class="line"> alpha：字母。</span><br><span class="line"> cntrl：控制（非打印）字符。</span><br><span class="line"> digit：数字。</span><br><span class="line"> graph：图形字符。</span><br><span class="line"> lower：小写字母。</span><br><span class="line"> <span class="built_in">print</span>：可打印字符。</span><br><span class="line"> punct：标点符号。</span><br><span class="line"> space：空白字符。</span><br><span class="line"> upper：大写字母。</span><br><span class="line"> xdigit：十六进制字符。</span><br></pre></td></tr></table></figure>




                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/Linux/Bash%E8%84%9A%E6%9C%AC%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/">Bash脚本基本语法</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2020-06-06</span>
                
                <span class="post-category">
                    
                    <a class="category" href="/categories/Linux/">Linux</a>
                    
                </span>
                
            </div>
            <div class="post-content">
                
                    <h3 id="array-sh"><a href="#array-sh" class="headerlink" title="array.sh"></a>array.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">names=(<span class="string">"Jason Chen"</span> <span class="string">"Bell"</span> <span class="string">"Alice"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print all array members</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;names[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">newNames=(<span class="string">"<span class="variable">$&#123;names[@]&#125;</span>"</span> <span class="string">"Jason Guo"</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;newNames[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">days=([0]=Sun [1]=Mon [2]=Tue [3]=Wed [4]=Thu [5]=Fri [6]=Sta)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"days: <span class="variable">$&#123;#days[@]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"value(index at 0): <span class="variable">$&#123;days[0]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"value's length at index 0: <span class="variable">$&#123;days[0]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## return indexes</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;!days[@]&#125;</span>; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"index: <span class="variable">$i</span>, value: <span class="variable">$&#123;days[$i]&#125;</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## extract array members: $&#123;array[@]:position:length&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;days[@]:1:3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## append to array</span></span><br><span class="line">days+=(<span class="string">"Unk"</span> Unk<span class="string">""</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;days[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## del a member from array</span></span><br><span class="line"><span class="built_in">unset</span> days[7]</span><br><span class="line">days[8]=<span class="string">''</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"after remove index[7,8]: <span class="variable">$&#123;days[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## empty array</span></span><br><span class="line"><span class="built_in">unset</span> days</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"after empty array: <span class="variable">$&#123;days[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"your input will be added to array:"</span></span><br><span class="line"><span class="built_in">read</span> -a dice</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;dice[@]&#125;</span>"</span>; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">declare</span> -A colors</span><br><span class="line">colors[<span class="string">"red"</span>]=<span class="string">"#ff0000"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;colors["red"]&#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="bashEnv-sh"><a href="#bashEnv-sh" class="headerlink" title="bashEnv.sh"></a>bashEnv.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">func1</span></span>() &#123;</span><br><span class="line">  <span class="comment">## 打印函数调用栈 FUNCNAME 返回一个数组，0号元素是当前调用的函数</span></span><br><span class="line">  <span class="comment">## 1 号元素是调用当前函数的函数，以此类推</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"\nfunction call stack:"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"FUNCNAME[0]: <span class="variable">$&#123;FUNCNAME[0]&#125;</span>"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"FUNCNAME[1]: <span class="variable">$&#123;FUNCNAME[1]&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"This is <span class="variable">$&#123;LINENO&#125;</span>th line in this script file"</span></span><br><span class="line">func1</span><br></pre></td></tr></table></figure>


<h3 id="custom-env-sh"><a href="#custom-env-sh" class="headerlink" title="custom_env.sh"></a>custom_env.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">export</span> CUST_ENV4=guo</span><br><span class="line">CUST_ENV5=peng</span><br><span class="line">CUST_ENV6=hui</span><br><span class="line"></span><br><span class="line">(<span class="built_in">echo</span> <span class="variable">$CUST_ENV4</span>)</span><br></pre></td></tr></table></figure>


<h3 id="hello-sh"><a href="#hello-sh" class="headerlink" title="hello.sh"></a>hello.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">hello=<span class="string">"hello world"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$hello</span>, Tang!"</span></span><br></pre></td></tr></table></figure>


<h3 id="if-sh"><a href="#if-sh" class="headerlink" title="if.sh"></a>if.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">"plz input your answer:"</span></span><br><span class="line"><span class="built_in">read</span> ans</span><br><span class="line"></span><br><span class="line"><span class="comment">### String condition test</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$ans</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"you input nothing!"</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$ans</span>"</span> = <span class="string">"yes"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Yeah!!!!!!!!"</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$ans</span>"</span> = <span class="string">"no"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Sorry to hear that!!!!!!!"</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$ans</span>"</span> = <span class="string">"maybe"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"You have make up your mind .-."</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"unknow answer"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">"plz input a num:"</span></span><br><span class="line"><span class="built_in">read</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment">### [[ ]] supports regex</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$INT</span>"</span> =~ ^-?[0-9]+$ ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"yeah, you input a number, good boy!"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"your input is not a number!"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### integer condition</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$INT</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"zero"</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$INT</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"great than zero"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"less than zero"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">'if ((3%2)) result='</span></span><br><span class="line"><span class="keyword">if</span> ((3%2)); <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"true"</span>; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"false"</span>; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">'if ((3%3)) result='</span></span><br><span class="line"><span class="keyword">if</span> ((3%3)); <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"true"</span>; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"false"</span>; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">'if ((3 &gt; 2)) result='</span></span><br><span class="line"><span class="keyword">if</span> ((3 &gt; 2)); <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"true"</span>; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"false"</span>; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">'if ((3 &lt; 2)) result='</span></span><br><span class="line"><span class="keyword">if</span> ((3 &lt; 2)); <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"true"</span>; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"false"</span>; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">'if ((3 == 3)) result='</span></span><br><span class="line"><span class="keyword">if</span> ((3 == 3)); <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"true"</span>; <span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"false"</span>; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## command1 || command2; if command1 is false, then run command2</span></span><br><span class="line">[ -d dir ] || mkdir dir</span><br></pre></td></tr></table></figure>


<h3 id="loop-sh"><a href="#loop-sh" class="headerlink" title="loop.sh"></a>loop.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## loop test</span></span><br><span class="line"></span><br><span class="line">number=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="string">"<span class="variable">$number</span>"</span> -le 10 ]; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$number</span> hello"</span></span><br><span class="line">        number=$((number+1))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *.sh; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"shell file: <span class="variable">$i</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## break continue</span></span><br><span class="line"><span class="keyword">for</span> (( i=0; i&lt;5; i=i+1 )); <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$i</span> -eq 3 ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"break statement"</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">                <span class="comment"># continue</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>


<h3 id="month-sh"><a href="#month-sh" class="headerlink" title="month.sh"></a>month.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#echo "input month number:"</span></span><br><span class="line"><span class="comment">#read monthNum</span></span><br><span class="line"></span><br><span class="line">monthNum=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$monthNum</span>"</span> =~ ^(1[0-2]|0?[1-9])$ ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">"you input <span class="variable">$monthNum</span>, and it is: "</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$monthNum</span> <span class="keyword">in</span></span><br><span class="line">        1 | 01) <span class="built_in">echo</span> <span class="string">"Jan"</span> ;;</span><br><span class="line">        2 | 02) <span class="built_in">echo</span> <span class="string">"Feb"</span> ;;</span><br><span class="line">        3 | 03) <span class="built_in">echo</span> <span class="string">"Mar"</span> ;;</span><br><span class="line">        4 | 04) <span class="built_in">echo</span> <span class="string">"Apr"</span> ;;</span><br><span class="line">        5 | 05) <span class="built_in">echo</span> <span class="string">"May"</span> ;;</span><br><span class="line">        6 | 06) <span class="built_in">echo</span> <span class="string">"Jun"</span> ;;</span><br><span class="line">        7 | 07) <span class="built_in">echo</span> <span class="string">"Jul"</span> ;;</span><br><span class="line">        8 | 08) <span class="built_in">echo</span> <span class="string">"Aug"</span> ;;</span><br><span class="line">        9 | 09) <span class="built_in">echo</span> <span class="string">"Sep"</span> ;;</span><br><span class="line">        10) <span class="built_in">echo</span> <span class="string">"Oct"</span> ;;</span><br><span class="line">        11) <span class="built_in">echo</span> <span class="string">"Nov"</span> ;;</span><br><span class="line">        12) <span class="built_in">echo</span> <span class="string">"Dec"</span> ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>


<h3 id="parameter-parse-sh"><a href="#parameter-parse-sh" class="headerlink" title="parameter-parse.sh"></a>parameter-parse.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">$(<span class="built_in">echo</span> <span class="string">'command'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PWD</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前脚本中没有定义该变量，但如果调用脚本的父shell定义了该变量，并使用 source 执行，则可以打印</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\nvariable defined in parent shell: <span class="variable">$CUST_ENV1</span>\n"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 时间: $(date <span class="string">'+%F %T'</span>)</span><br><span class="line"><span class="built_in">echo</span> 带有option的参数列表: <span class="variable">$@</span></span><br><span class="line"><span class="built_in">echo</span> 带有option的参数个数: <span class="variable">$#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">'sn:'</span> OPT; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">"<span class="variable">$OPT</span>"</span> <span class="keyword">in</span></span><br><span class="line">        s)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"silent output enabled"</span></span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">        n)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"output number: <span class="variable">$OPTARG</span>"</span></span><br><span class="line">        ;;</span><br><span class="line">        ?)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"avaliable options: [-s] [-n number]"</span> &gt;&amp;2 <span class="comment">## standard error</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">shift</span> <span class="string">"<span class="variable">$(($OPTIND - 1)</span>)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"option 选项处理完成，处理剩余主参数列表: <span class="variable">$@</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## for 循环遍历参数列表</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\nfor 循环便利参数列表"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$@</span>; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> 参数：<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\nshift 遍历参数列表：<span class="variable">$@</span>"</span></span><br><span class="line"><span class="comment">## shift n 移除脚本当前n个参数, 没有指定默认为1；</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="string">"<span class="variable">$1</span>"</span> != <span class="string">""</span> ]; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> 参数个数：<span class="variable">$#</span></span><br><span class="line">  <span class="built_in">echo</span> 参数：<span class="variable">$1</span></span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>


<h3 id="readFile-sh"><a href="#readFile-sh" class="headerlink" title="readFile.sh"></a>readFile.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> == 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"请指定文件路径"</span></span><br><span class="line">  <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"\nfile: <span class="variable">$i</span>"</span></span><br><span class="line">    num=1</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"<span class="variable">$((num++)</span>)\t<span class="variable">$line</span>"</span></span><br><span class="line">    <span class="keyword">done</span> &lt; <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>


<h3 id="readInput-sh"><a href="#readInput-sh" class="headerlink" title="readInput.sh"></a>readInput.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">"输入您的用户名 &gt; "</span></span><br><span class="line"><span class="built_in">read</span> user</span><br><span class="line"><span class="built_in">read</span> -s -p <span class="string">"请输入密码 &gt; "</span> passwd1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">read</span> -s -p <span class="string">"请确认密码 &gt; "</span> passwd2</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$passwd1</span>"</span> == <span class="string">"<span class="variable">$passwd2</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"注册成功, 用户名: '<span class="variable">$user</span>', 密码: '<span class="variable">$passwd1</span>'"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"密码输入不一致: '<span class="variable">$passwd1</span>', '<span class="variable">$passwd2</span>'"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>


<h3 id="select-sh"><a href="#select-sh" class="headerlink" title="select.sh"></a>select.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"select the seq number to choose(use ctrl+c to quit)"</span></span><br><span class="line"></span><br><span class="line">select gender <span class="keyword">in</span> male female other</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$gender</span> <span class="keyword">in</span></span><br><span class="line">                <span class="string">"male"</span>)   <span class="built_in">echo</span> <span class="string">"Hi man"</span> ;;</span><br><span class="line">                <span class="string">"female"</span>) <span class="built_in">echo</span> <span class="string">"Hi girl"</span> ;;</span><br><span class="line">                <span class="string">"other"</span>)  <span class="built_in">echo</span> <span class="string">"Hi there"</span> ;;</span><br><span class="line">                *)        <span class="built_in">echo</span> <span class="string">"Unknow seq"</span> ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>


<h3 id="setShellDisallowNoUnset-sh"><a href="#setShellDisallowNoUnset-sh" class="headerlink" title="setShellDisallowNoUnset.sh"></a>setShellDisallowNoUnset.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set -o nounset: none set variable will case exit</span></span><br><span class="line"><span class="built_in">set</span> -u</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hi"</span></span><br></pre></td></tr></table></figure>


<h3 id="setShellExitOnError-sh"><a href="#setShellExitOnError-sh" class="headerlink" title="setShellExitOnError.sh"></a>setShellExitOnError.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遇到错误退出可以使用 command1 || exit 1, 如果 commands 1 执行失败，就执行 exit 1</span></span><br><span class="line"><span class="comment"># ls *.exe || exit 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 -e 设置， set -o errexit</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不存在 dll文件，不会终止，只要管道最后的命令执行成功</span></span><br><span class="line"><span class="comment"># 为了避免这种情况，可以使用 set -eo pipefail</span></span><br><span class="line">ls *.dll | <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不存在 exe文件，错误终止</span></span><br><span class="line">ls *.exe</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"hi there"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set +e 可以关闭该设置</span></span><br></pre></td></tr></table></figure>


<h3 id="setShellallowTrace-sh"><a href="#setShellallowTrace-sh" class="headerlink" title="setShellallowTrace.sh"></a>setShellallowTrace.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set -o xtrace</span></span><br><span class="line"><span class="built_in">set</span> -x</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$PWD</span>"</span></span><br></pre></td></tr></table></figure>


<h3 id="temp-sh"><a href="#temp-sh" class="headerlink" title="temp.sh"></a>temp.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本退出时，删除创建的临时文件</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">'rm -f "$tmpFile"'</span> EXIT</span><br><span class="line"></span><br><span class="line">tmpFile=$(mktemp) || <span class="built_in">exit</span> 1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"temporary file created successfully: <span class="variable">$tmpFile</span>"</span></span><br></pre></td></tr></table></figure>

                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/Linux/WSL/">WSL</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2020-06-06</span>
                
                <span class="post-category">
                    
                    <a class="category" href="/categories/Linux/">Linux</a>
                    
                </span>
                
            </div>
            <div class="post-content">
                
                    <h2 id="Make-it-started-when-you-start-your-Windows"><a href="#Make-it-started-when-you-start-your-Windows" class="headerlink" title="Make it started when you start your Windows"></a>Make it started when you start your Windows</h2><p>wsl-ubuntun.vbs - 开机自启</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Set</span> ws = <span class="built_in">CreateObject</span>(<span class="string">"Wscript.Shell"</span>)</span><br><span class="line">ws.run <span class="string">"C:\Users\guo\AppData\Local\Microsoft\WindowsApps\ubuntu1804.exe run sudo /etc/init.wsl"</span>, vbhide</span><br></pre></td></tr></table></figure>



<p>/etc/init.wsl</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line">/etc/init.d/ssh restart</span><br><span class="line">/etc/init.d/mysql restart</span><br><span class="line">/etc/init.d/cron restart</span><br></pre></td></tr></table></figure>


                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/Linux/Man/">Man</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2020-06-02</span>
                
                <span class="post-category">
                    
                    <a class="category" href="/categories/Linux/">Linux</a>
                    
                </span>
                
            </div>
            <div class="post-content">
                
                    <h3 id="hexdump"><a href="#hexdump" class="headerlink" title="hexdump"></a>hexdump</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">HEXDUMP(1)                                                                                            BSD General Commands Manual                                                                                           HEXDUMP(1)</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">     hexdump, hd — ASCII, decimal, hexadecimal, octal dump</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">     hexdump [-bcCdovx] [-e format_string] [-f format_file] [-n length] [-s offset] file ...</span><br><span class="line">     hd [-bcdovx] [-e format_string] [-f format_file] [-n length] [-s offset] file ...</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">     The hexdump utility is a filter <span class="built_in">which</span> displays the specified files, or the standard input, <span class="keyword">if</span> no files are specified, <span class="keyword">in</span> a user specified format.</span><br><span class="line"></span><br><span class="line">     The options are as follows:</span><br><span class="line"></span><br><span class="line">     -b      One-byte octal display.  Display the input offset <span class="keyword">in</span> hexadecimal, followed by sixteen space-separated, three column, zero-filled, bytes of input data, <span class="keyword">in</span> octal, per line.</span><br><span class="line"></span><br><span class="line">     -c      One-byte character display.  Display the input offset <span class="keyword">in</span> hexadecimal, followed by sixteen space-separated, three column, space-filled, characters of input data per line.</span><br><span class="line"></span><br><span class="line">     -C      Canonical hex+ASCII display.  Display the input offset <span class="keyword">in</span> hexadecimal, followed by sixteen space-separated, two column, hexadecimal bytes, followed by the same sixteen bytes <span class="keyword">in</span> %_p format enclosed <span class="keyword">in</span> ``|<span class="string">''</span> characters.</span><br><span class="line"></span><br><span class="line">             Calling the <span class="built_in">command</span> hd implies this option.</span><br><span class="line"></span><br><span class="line">     -d      Two-byte decimal display.  Display the input offset <span class="keyword">in</span> hexadecimal, followed by eight space-separated, five column, zero-filled, two-byte units of input data, <span class="keyword">in</span> unsigned decimal, per line.</span><br><span class="line"></span><br><span class="line">     -e format_string</span><br><span class="line">             Specify a format string to be used <span class="keyword">for</span> displaying data.</span><br><span class="line"></span><br><span class="line">     -f format_file</span><br><span class="line">             Specify a file that contains one or more newline separated format strings.  Empty lines and lines whose first non-blank character is a <span class="built_in">hash</span> mark (<span class="comment">#) are ignored.</span></span><br><span class="line"></span><br><span class="line">     -n length</span><br><span class="line">             Interpret only length bytes of input.</span><br><span class="line"></span><br><span class="line">     -o      Two-byte octal display.  Display the input offset <span class="keyword">in</span> hexadecimal, followed by eight space-separated, six column, zero-filled, two byte quantities of input data, <span class="keyword">in</span> octal, per line.</span><br><span class="line"></span><br><span class="line">     -s offset</span><br><span class="line">             Skip offset bytes from the beginning of the input.  By default, offset is interpreted as a decimal number.  With a leading 0x or 0X, offset is interpreted as a hexadecimal number, otherwise, with a leading 0, offset</span><br><span class="line">             is interpreted as an octal number.  Appending the character b, k, or m to offset causes it to be interpreted as a multiple of 512, 1024, or 1048576, respectively.</span><br><span class="line"></span><br><span class="line">     -v      Cause hexdump to display all input data.  Without the -v option, any number of groups of output lines, <span class="built_in">which</span> would be identical to the immediately preceding group of output lines (except <span class="keyword">for</span> the input offsets), are</span><br><span class="line">             replaced with a line comprised of a single asterisk.</span><br><span class="line"></span><br><span class="line">     -x      Two-byte hexadecimal display.  Display the input offset <span class="keyword">in</span> hexadecimal, followed by eight, space separated, four column, zero-filled, two-byte quantities of input data, <span class="keyword">in</span> hexadecimal, per line.</span><br><span class="line"></span><br><span class="line">     For each input file, hexdump sequentially copies the input to standard output, transforming the data according to the format strings specified by the -e and -f options, <span class="keyword">in</span> the order that they were specified.</span><br><span class="line"></span><br><span class="line">   Formats</span><br><span class="line">     A format string contains any number of format units, separated by whitespace.  A format unit contains up to three items: an iteration count, a byte count, and a format.</span><br><span class="line"></span><br><span class="line">     The iteration count is an optional positive <span class="built_in">integer</span>, <span class="built_in">which</span> defaults to one.  Each format is applied iteration count <span class="built_in">times</span>.</span><br><span class="line"></span><br><span class="line">     The byte count is an optional positive <span class="built_in">integer</span>.  If specified it defines the number of bytes to be interpreted by each iteration of the format.</span><br><span class="line"></span><br><span class="line">     If an iteration count and/or a byte count is specified, a single slash must be placed after the iteration count and/or before the byte count to disambiguate them.  Any whitespace before or after the slash is ignored.</span><br><span class="line"></span><br><span class="line">     The format is required and must be surrounded by double quote (<span class="string">" "</span>) marks.  It is interpreted as a fprintf-style format string (see fprintf(3)), with the following exceptions:</span><br><span class="line"></span><br><span class="line">           ·   An asterisk (*) may not be used as a field width or precision.</span><br><span class="line"></span><br><span class="line">           ·   A byte count or field precision is required <span class="keyword">for</span> each ``s<span class="string">''</span> conversion character (unlike the fprintf(3) default <span class="built_in">which</span> prints the entire string <span class="keyword">if</span> the precision is unspecified).</span><br><span class="line"></span><br><span class="line">           ·   The conversion characters ``%<span class="string">''</span>, ``h<span class="string">''</span>, ``l<span class="string">''</span>, ``n<span class="string">''</span>, ``p<span class="string">''</span> and ``q<span class="string">''</span> are not supported.</span><br><span class="line"></span><br><span class="line">           ·   The single character escape sequences described <span class="keyword">in</span> the C standard are supported:</span><br><span class="line"></span><br><span class="line">                     NUL                  \0</span><br><span class="line">                     &lt;alert character&gt;    \a</span><br><span class="line">                     &lt;backspace&gt;          \b</span><br><span class="line">                     &lt;form-feed&gt;          \f</span><br><span class="line">                     &lt;newline&gt;            \n</span><br><span class="line">                     &lt;carriage <span class="built_in">return</span>&gt;    \r</span><br><span class="line">                     &lt;tab&gt;                \t</span><br><span class="line">                     &lt;vertical tab&gt;       \v</span><br><span class="line"></span><br><span class="line">     The hexdump utility also supports the following additional conversion strings:</span><br><span class="line"></span><br><span class="line">     _a[dox]     Display the input offset, cumulative across input files, of the next byte to be displayed.  The appended characters d, o, and x specify the display base as decimal, octal or hexadecimal respectively.</span><br><span class="line"></span><br><span class="line">     _A[dox]     Identical to the _a conversion string except that it is only performed once, when all of the input data has been processed.</span><br><span class="line"></span><br><span class="line">     _c          Output characters <span class="keyword">in</span> the default character <span class="built_in">set</span>.  Nonprinting characters are displayed <span class="keyword">in</span> three character, zero-padded octal, except <span class="keyword">for</span> those representable by standard escape notation (see above), <span class="built_in">which</span> are dis‐</span><br><span class="line">                 played as two character strings.</span><br><span class="line"></span><br><span class="line">     _p          Output characters <span class="keyword">in</span> the default character <span class="built_in">set</span>.  Nonprinting characters are displayed as a single “.”.</span><br><span class="line"></span><br><span class="line">     _u          Output US ASCII characters, with the exception that control characters are displayed using the following, lower-case, names.  Characters greater than 0xff, hexadecimal, are displayed as hexadecimal strings.</span><br><span class="line"></span><br><span class="line">                 000 NUL  001 SOH  002 STX  003 ETX  004 EOT  005 ENQ</span><br><span class="line">                 006 ACK  007 BEL  008 BS   009 HT   00A LF   00B VT</span><br><span class="line">                 00C FF   00D CR   00E SO   00F SI   010 DLE  011 DC1</span><br><span class="line">                 012 DC2  013 DC3  014 DC4  015 NAK  016 SYN  017 ETB</span><br><span class="line">                 018 CAN  019 EM   01A SUB  01B ESC  01C FS   01D GS</span><br><span class="line">                 01E RS   01F US   07F DEL</span><br><span class="line"></span><br><span class="line">     The default and supported byte counts <span class="keyword">for</span> the conversion characters are as follows:</span><br><span class="line"></span><br><span class="line">           %_c, %_p, %_u, %c       One byte counts only.</span><br><span class="line"></span><br><span class="line">           %d, %i, %o, %u, %X, %x  Four byte default, one, two and four byte counts supported.</span><br><span class="line"></span><br><span class="line">           %E, %e, %f, %G, %g      Eight byte default, four and twelve byte counts supported.</span><br><span class="line"></span><br><span class="line">     The amount of data interpreted by each format string is the sum of the data required by each format unit, <span class="built_in">which</span> is the iteration count <span class="built_in">times</span> the byte count, or the iteration count <span class="built_in">times</span> the number of bytes required by the</span><br><span class="line">     format <span class="keyword">if</span> the byte count is not specified.</span><br><span class="line"></span><br><span class="line">     The input is manipulated <span class="keyword">in</span> ``blocks<span class="string">''</span>, <span class="built_in">where</span> a block is defined as the largest amount of data specified by any format string.  Format strings interpreting less than an input block<span class="string">'s worth of data, whose last format unit both interprets some number of bytes and does not have a specified iteration count, have the iteration count incremented until the entire input block has been processed or there is not enough data remaining in the block to satisfy the format string.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     If, either as a result of user specification or hexdump modifying the iteration count as described above, an iteration count is greater than one, no trailing whitespace characters are output during the last iteration.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     It is an error to specify a byte count as well as multiple conversion characters or strings unless all but one of the conversion characters or strings is _a or _A.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     If, as a result of the specification of the -n option or end-of-file being reached, input data only partially satisfies a format string, the input block is zero-padded sufficiently to display all available data (i.e., any</span></span><br><span class="line"><span class="string">     format units overlapping the end of data will display some number of the zero bytes).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     Further output by such format strings is replaced by an equivalent number of spaces.  An equivalent number of spaces is defined as the number of spaces output by an s conversion character with the same field width and preci‐</span></span><br><span class="line"><span class="string">     sion as the original conversion character or conversion string but with any “+”, “ ”, “#” conversion flag characters removed, and referencing a NULL string.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     If no format strings are specified, the default display is equivalent to specifying the -x option.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EXIT STATUS</span></span><br><span class="line"><span class="string">     The hexdump and hd utilities exit 0 on success, and &gt;0 if an error occurs.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EXAMPLES</span></span><br><span class="line"><span class="string">     Display the input in perusal format:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           "%06.6_ao "  12/1 "%3_u "</span></span><br><span class="line"><span class="string">           "\t\t" "%_p "</span></span><br><span class="line"><span class="string">           "\n"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     Implement the -x option:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           "%07.7_Ax\n"</span></span><br><span class="line"><span class="string">           "%07.7_ax  " 8/2 "%04x " "\n"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     Some examples for the -e option:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           # hex bytes</span></span><br><span class="line"><span class="string">           % echo hello | hexdump -v -e '</span>/1 <span class="string">"%02X "</span><span class="string">' ; echo</span></span><br><span class="line"><span class="string">           68 65 6C 6C 6F 0A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           # same, with ASCII section</span></span><br><span class="line"><span class="string">           % echo hello | hexdump -e '</span>8/1 <span class="string">"%02X "</span><span class="string">"\t"</span><span class="string">" "</span><span class="string">' -e '</span>8/1 <span class="string">"%c"</span><span class="string">"\n"</span><span class="string">'</span></span><br><span class="line"><span class="string">           68 65 6C 6C 6F 0A        hello</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           # hex with preceding '</span>x<span class="string">'</span></span><br><span class="line"><span class="string">           % echo hello | hexdump -v -e '</span><span class="string">"x"</span> 1/1 <span class="string">"%02X"</span> <span class="string">" "</span><span class="string">' ; echo</span></span><br><span class="line"><span class="string">           x68 x65 x6C x6C x6F x0A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           # one hex byte per line</span></span><br><span class="line"><span class="string">           % echo hello | hexdump -v -e '</span>/1 <span class="string">"%02X\n"</span><span class="string">'</span></span><br><span class="line"><span class="string">           68</span></span><br><span class="line"><span class="string">           65</span></span><br><span class="line"><span class="string">           6C</span></span><br><span class="line"><span class="string">           6C</span></span><br><span class="line"><span class="string">           6F</span></span><br><span class="line"><span class="string">           0A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           # a table of byte#, hex, decimal, octal, ASCII</span></span><br><span class="line"><span class="string">           % echo hello | hexdump -v  -e '</span>/1  <span class="string">"%_ad#    "</span><span class="string">' -e '</span>/1    <span class="string">"%02X hex"</span><span class="string">' -e '</span>/1 <span class="string">" = %03i dec"</span><span class="string">' -e '</span>/1 <span class="string">" = %03o oct"</span><span class="string">' -e '</span>/1 <span class="string">" = _%c\_\n"</span><span class="string">'</span></span><br><span class="line"><span class="string">           0#    68 hex = 104 dec = 150 oct = _h_</span></span><br><span class="line"><span class="string">           1#    65 hex = 101 dec = 145 oct = _e_</span></span><br><span class="line"><span class="string">           2#    6C hex = 108 dec = 154 oct = _l_</span></span><br><span class="line"><span class="string">           3#    6C hex = 108 dec = 154 oct = _l_</span></span><br><span class="line"><span class="string">           4#    6F hex = 111 dec = 157 oct = _o_</span></span><br><span class="line"><span class="string">           5#    0A hex = 010 dec = 012 oct = _</span></span><br><span class="line"><span class="string">           _</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           # byte# &amp; ASCII with control chars</span></span><br><span class="line"><span class="string">           % echo hello | hexdump -v  -e '</span>/1  <span class="string">"%_ad#  "</span><span class="string">' -e '</span>/1 <span class="string">" _%_u\_\n"</span><span class="string">'</span></span><br><span class="line"><span class="string">           0#   _h_</span></span><br><span class="line"><span class="string">           1#   _e_</span></span><br><span class="line"><span class="string">           2#   _l_</span></span><br><span class="line"><span class="string">           3#   _l_</span></span><br><span class="line"><span class="string">           4#   _o_</span></span><br><span class="line"><span class="string">           5#   _lf_</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SEE ALSO</span></span><br><span class="line"><span class="string">     gdb(1), od(1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">BSD                                                                                                        October 29, 2014                                                                                                        BSD</span></span><br></pre></td></tr></table></figure>


                
            </div>
        </article>
    
        <article class="post-abstract">
            <div class="post-title">
                <h2><a class="post-title-link" href="/Mysql/TimeStamp/">TimeStamp</a></h2>
            </div>
            <div class="post-meta">
                <span class="post-time">2020-05-31</span>
                
                <span class="post-category">
                    
                    <a class="category" href="/categories/Mysql/">Mysql</a>
                    
                </span>
                
            </div>
            <div class="post-content">
                
                    <p>5.1.13 MySQL Server Time Zone Support</p>
<p>11.2 Date and Time Data Types</p>
<p>Section 11.2.6, “Automatic Initialization and Updating for TIMESTAMP and DATETIME”.</p>
<p>格林威治时间 </p>
<p>UTC</p>
<p><a href="https://www.liaoxuefeng.com/article/978494994163392" target="_blank" rel="noopener">廖雪峰-如何正确的处理时间</a></p>
<p><a href="https://stackoverflow.com/questions/7605953/how-to-change-mysql-timezone-in-a-database-connection-using-java?spm=a2c6h.13066369.0.0.4a3d35feS3vSBf" target="_blank" rel="noopener">jdbc url timezone</a></p>
<p>Server SQL Modes</p>
<p>ALLOW_INVALID_DATES</p>
<p>STRICT_MODE</p>
<p>NO_ZERO_DATE</p>
<ul>
<li><p><code>TIMESTAMP</code> 类型的的范围 <code>1970-01-01 00:00:01.000000</code> UTC 到 <code>2038-01-19
03:14:07.999999</code> UTC，注意是 UTC 时间</p>
</li>
<li><p><code>TIMESTAMP</code> 的值存储为自 epoch <code>1970-01-01 00:00:00</code> UTC 的秒数</p>
</li>
<li><p><code>TIMESTAMP[(fsp)]</code> fsp (0-6) 表示可以指定小数秒数精度， 默认是 0 ，表示没有用小数部分， 如 ‘2038-01-19 03:14:07.999999’</p>
</li>
<li><p>STRICT_MODE, NO_ZERO_DATE 决定是否可以设为 ‘0’ 值 （0000-00-00 00:00:00）</p>
</li>
<li><p>Automatic initialization and updating to the current date and time can be specified using DEFAULT CURRENT_TIMESTAMP and ON UPDATE CURRENT_TIMESTAMP column definition clauses. By default, the first TIMESTAMP column has these properties, as previously noted. However, any TIMESTAMP column in a table can be defined to have these properties.</p>
</li>
</ul>
<blockquote>
<p>MySQL converts <code>TIMESTAMP</code> values from the current time zone to UTC for storage, and back from UTC to the current time zone for retrieval. (This does not occur for other types such as <code>DATETIME</code>) By default, the current time zone for each connection is the server’s time. The time zone can be set on a per-connection basis. As long as the time zone settings remains constant, you get back the same value you store. If you store a <code>TIMESTAM</code> value, and then change the time zone and retrieve the value, the value is different from the value you stored. The current time zone is avaliable as the value of the <code>time_zone</code> system variable.  This occurs because the same time zone was not used for conversion in both directions. The current time zone is available as the value of the <code>time_zone</code> system variable. For more information, see Section 5.1.13, “MySQL Server Time Zone Support”.</p>
</blockquote>
<h3 id="MySQL-Server-Time-Zone-Support"><a href="#MySQL-Server-Time-Zone-Support" class="headerlink" title="MySQL Server Time Zone Support"></a>MySQL Server Time Zone Support</h3><ul>
<li><p>system time zone  系统时区，server 启动时，尝试自动获取所在机器的时区，并设置为 <code>system_time_zone</code> 系统变量（system variable）</p>
<p>要显示指定 Mysql Server 启动时的系统时区，启动 <code>mysqld</code> 服务前，设置 <code>TZ</code> 环境变量。 如果使用 <code>mysqld_safe</code>, 使用 <code>--timezone</code> 选项也可以设置</p>
</li>
<li><p>server time zone 服务器当前时区， 全局 <code>time_zone</code>系统变量表明了 server 当前操作使用的时区. <code>time_zone</code> 的初始化值是 <code>SYSTEM</code>, 表示和系统时区 (system time zone) 相同;  初始的全局 server time zone 也可以通过命令行选项 <code>--default-time-zone</code> 来设置，或者在 option 文件中指定 <code>default-time-zone=&#39;timezone&#39;</code>； 如果拥有权限，也可以在运行时设置：</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> <span class="keyword">time_zone</span> = timezone;</span><br></pre></td></tr></table></figure>

<ul>
<li>per-session time zone 针对每个会话的时区，每一个连接的客户端都有自己的会话时区设置，通过会话范围内的 <code>time_zone</code> 变量来设置；默认会话变量会从全局 <code>time_zone</code> 变量继承，但是客户端也可以修改：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">time_zone</span> = timezone;</span><br></pre></td></tr></table></figure>

<p>  会话时区设置会影响与时区相关（zone-sensitive）的数据类型的展示和存储. 包含 <code>NOW()</code> 或者 <code>CURTIME</code> 函数值的展示，以及 <code>TIMESTAMP</code> 列的值的存储和查询. 存储时，<code>TIMESTAMP</code> 列的值会从当前会话时区转为 UTC 进行存储，查询时，再从 UTC 时间转为当前会话的时区时间</p>
<p>  <code>UTC_TIMESTAMP</code> 函数和 <code>DATE</code>, <code>TIME</code> 或者 <code>DATETIME</code> 列的值不受会话时区影响，它们也不是转为 UTC 存储</p>
<h3 id="timezone-时区的设置格式"><a href="#timezone-时区的设置格式" class="headerlink" title="timezone 时区的设置格式"></a>timezone 时区的设置格式</h3><ul>
<li>指定为 <code>SYSTEM</code>, 表明使用系统时区 system time zone</li>
<li>指定一个 UTC 偏移量的字符串, <code>+/-[H]H:MM</code>, 如 ‘+10:00’， ‘-6:00’ （前面会自动补 0）. 有效范围 ‘-12:59’  - ‘+13:00’ inclusive</li>
<li>‘Europe/Helsinki’, ‘US/Eastern’ 类似于这种命名时区，需要 <code>mysql</code> 库中创建的了时区信息表，并且填充了数据</li>
</ul>
<h3 id="JDBC-查询-TIMESTAMP"><a href="#JDBC-查询-TIMESTAMP" class="headerlink" title="JDBC 查询 TIMESTAMP"></a>JDBC 查询 TIMESTAMP</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// step 1 </span></span><br><span class="line">com.mysql.jdbc.ResultSetImpl#getTimestamp(int)</span><br><span class="line"></span><br><span class="line"><span class="comment">// step 2</span></span><br><span class="line">com.mysql.jdbc.ResultSetImpl#getTimestampInternal</span><br><span class="line"></span><br><span class="line"><span class="comment">// step3</span></span><br><span class="line">com.mysql.jdbc.ByteArrayRow#getTimestampFast</span><br><span class="line"></span><br><span class="line"><span class="comment">// step4</span></span><br><span class="line">com.mysql.jdbc.ResultSetRow#getTimestampFast(int, byte[], int, int, java.util.Calendar, java.util.TimeZone, boolean, com.mysql.jdbc.MySQLConnection, com.mysql.jdbc.ResultSetImpl)   </span><br><span class="line"></span><br><span class="line"><span class="comment">// step5</span></span><br><span class="line">(useLegacyDatetimeCode=false) mysql.jdbc.TimeUtil#fastTimestampCreate(java.util.TimeZone, int, int, int, int, int, int, int)</span><br><span class="line">    或</span><br><span class="line">(useLegacyDatetimeCode=false) com.mysql.jdbc.TimeUtil#changeTimezone(com.mysql.jdbc.MySQLConnection, java.util.Calendar, java.util.Calendar, java.sql.Timestamp, java.util.TimeZone, java.util.TimeZone, boolean)</span><br></pre></td></tr></table></figure>



<p>INIT</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"net_buffer_length"</span> -&gt; <span class="string">"16384"</span></span><br><span class="line"><span class="string">"interactive_timeout"</span> -&gt; <span class="string">"28800"</span></span><br><span class="line"><span class="string">"query_cache_size"</span> -&gt; <span class="string">"16777216"</span></span><br><span class="line"><span class="string">"character_set_connection"</span> -&gt; <span class="string">"utf8"</span></span><br><span class="line"><span class="string">"max_allowed_packet"</span> -&gt; <span class="string">"16777216"</span></span><br><span class="line"><span class="string">"net_write_timeout"</span> -&gt; <span class="string">"60"</span></span><br><span class="line"><span class="string">"lower_case_table_names"</span> -&gt; <span class="string">"0"</span></span><br><span class="line"><span class="string">"system_time_zone"</span> -&gt; <span class="string">"CST"</span></span><br><span class="line"><span class="string">"tx_isolation"</span> -&gt; <span class="string">"REPEATABLE-READ"</span></span><br><span class="line"><span class="string">"time_zone"</span> -&gt; <span class="string">"SYSTEM"</span></span><br><span class="line"><span class="string">"wait_timeout"</span> -&gt; <span class="string">"28800"</span></span><br><span class="line"><span class="string">"character_set_server"</span> -&gt; <span class="string">"utf8"</span></span><br><span class="line"><span class="string">"auto_increment_increment"</span> -&gt; <span class="string">"1"</span></span><br><span class="line"><span class="string">"license"</span> -&gt; <span class="string">"GPL"</span></span><br><span class="line"><span class="string">"character_set_client"</span> -&gt; <span class="string">"utf8"</span></span><br><span class="line"><span class="string">"sql_mode"</span> -&gt; <span class="string">"ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"</span></span><br><span class="line"><span class="string">"character_set_results"</span> -&gt; <span class="string">"utf8"</span></span><br><span class="line"><span class="string">"query_cache_type"</span> -&gt; <span class="string">"OFF"</span></span><br><span class="line"><span class="string">"init_connect"</span> -&gt; <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    com.mysql.jdbc.ConnectionImpl#configureTimezone</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1. configuredTimeZoneOnServer=CST</span></span><br><span class="line">    </span><br><span class="line">    com.mysql.jdbc.ConnectionPropertiesImpl#getServerTimezone</span><br><span class="line">    <span class="comment">// 2. 返回 url 中配置的 serverTimezone： canonicalTimezone = America/New_York</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServerTimezone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.serverTimezone.getValueAsString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. (getUseTimezone() || !getUseLegacyDatetimeCode()) &amp;&amp; configuredTimeZoneOnServer != null)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. this.serverTimezoneTZ = sun.util.calendar.ZoneInfo[id="America/New_York",offset=-18000000,dstSavings=3600000,useDaylight=true,transitions=235,lastRule=java.util.SimpleTimeZone[id=America/New_York,offset=-18000000,dstSavings=3600000,useDaylight=true,startYear=0,startMode=3,startMonth=2,startDay=8,startDayOfWeek=1,startTime=7200000,startTimeMode=0,endMode=3,endMonth=10,endDay=1,endDayOfWeek=1,endTime=7200000,endTimeMode=0]]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Configures the client's timezone if required.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     *             if the timezone the server is configured to use can't be</span></span><br><span class="line"><span class="comment">     *             mapped to a Java timezone.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureTimezone</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        String configuredTimeZoneOnServer = <span class="keyword">this</span>.serverVariables.get(<span class="string">"timezone"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (configuredTimeZoneOnServer == <span class="keyword">null</span>) &#123;</span><br><span class="line">            configuredTimeZoneOnServer = <span class="keyword">this</span>.serverVariables.get(<span class="string">"time_zone"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"SYSTEM"</span>.equalsIgnoreCase(configuredTimeZoneOnServer)) &#123;</span><br><span class="line">                configuredTimeZoneOnServer = <span class="keyword">this</span>.serverVariables.get(<span class="string">"system_time_zone"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String canonicalTimezone = getServerTimezone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((getUseTimezone() || !getUseLegacyDatetimeCode()) &amp;&amp; configuredTimeZoneOnServer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// user can override this with driver properties, so don't detect if that's the case</span></span><br><span class="line">            <span class="keyword">if</span> (canonicalTimezone == <span class="keyword">null</span> || StringUtils.isEmptyOrWhitespaceOnly(canonicalTimezone)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    canonicalTimezone = TimeUtil.getCanonicalTimezone(configuredTimeZoneOnServer, getExceptionInterceptor());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalArgumentException iae) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> SQLError.createSQLException(iae.getMessage(), SQLError.SQL_STATE_GENERAL_ERROR, getExceptionInterceptor());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (canonicalTimezone != <span class="keyword">null</span> &amp;&amp; canonicalTimezone.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.serverTimezoneTZ = TimeZone.getTimeZone(canonicalTimezone);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// The Calendar class has the behavior of mapping unknown timezones to 'GMT' instead of throwing an exception, so we must check for this...</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="keyword">if</span> (!canonicalTimezone.equalsIgnoreCase(<span class="string">"GMT"</span>) &amp;&amp; <span class="keyword">this</span>.serverTimezoneTZ.getID().equals(<span class="string">"GMT"</span>)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> SQLError.createSQLException(<span class="string">"No timezone mapping entry for '"</span> + canonicalTimezone + <span class="string">"'"</span>, SQLError.SQL_STATE_ILLEGAL_ARGUMENT,</span><br><span class="line">                        getExceptionInterceptor());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.isServerTzUTC = !<span class="keyword">this</span>.serverTimezoneTZ.useDaylightTime() &amp;&amp; <span class="keyword">this</span>.serverTimezoneTZ.getRawOffset() == <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Calendar.DST_OFFSET</span><br><span class="line">Calendar.DST_OFFSET</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 相关时区设置和查看命令</span></span><br><span class="line"></span><br><span class="line">SET GLOBAL time_zone = <span class="string">"+5:00"</span>;</span><br><span class="line"></span><br><span class="line">SELECT @@GLOBAL.time_zone, @@SESSION.time_zone;</span><br><span class="line"><span class="comment"># @@GLOBAL.time_zone	@@SESSION.time_zone</span></span><br><span class="line"><span class="comment"># SYSTEM	SYSTEM</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show variables like <span class="string">'%time_zone%'</span>;</span><br><span class="line"><span class="comment"># Variable_name	Value</span></span><br><span class="line"><span class="comment"># system_time_zone	CST</span></span><br><span class="line"><span class="comment"># time_zone	SYSTEM</span></span><br></pre></td></tr></table></figure>



<p>CST 是个坑，安装的 Mysql 查看系统时区，显示 <code>CST</code>， 其实是东八区 <code>UTC+8</code>, 可以通过改变会话时区查看 <code>TIMESTAMP</code> 列的值进行验证，但是在 Java 中，<code>CST</code> 指的就是 <code>Central Standard Time</code>， 是 <code>UTC-6</code>,  所以如果客户端，如 Java 程序默认的时区就是 <code>Asia/Shanghai (UTC+8)</code>, 不指定任何时区转换设置，操作和显示没有什么问题；Mysql 系统时区变量为 <code>CST</code>, Mysql Server 默认全局时区（System Time Zone - 全局 time_zone 变量） 为 <code>SYSTEM</code> , 继承自系统时区，会话时区默认（Session Time Zone - 局部 time_zone 变量）继承全局时区，最终其实就是 <code>UTC+8</code>。</p>
<p>如果特意在 jdbc url 中指定 <code>serverTimezone=CST</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql:<span class="comment">//localhost:3306/learning_db?useUnicode=true&amp;characterEncoding=utf8&amp;useLegacyDatetimeCode=true&amp;useTimezone=true&amp;serverTimezone=CST</span></span><br></pre></td></tr></table></figure>

<p>Mysql 查询 <code>TIMESTAMP</code> 列时，将存储的 <code>UTC+0</code> 时间转换为默认的会话时区时间，默认的会话时区是 <code>UTC+8</code>, 在 Mysql 里显示的是 <code>SYSTEM</code>，继承的 <code>CST</code>(这里虽然是 CST, 其实是 UTC+8, 系统时区默认取机器的时区，通过 <code>date -R</code>, 显示 <code>+8:00</code>), 这时候又指定了  <code>serverTimezone=CST</code>, JDBC 获取的系统时区服务器变量 <code>system_time_zone</code>是 <code>CST</code>,  但不是同一个东西，Java 将这个指定的<code>CST</code>转换为时区对象时，转换的就是 <code>UTC-6</code>, 而在 Mysql 服务器一侧是 <code>UTC+8</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 中，如果是 CST  TimeZone.getTimeZone("CST"), offset=-21600000， 即 'UTC-6'</span></span><br><span class="line">sun.util.calendar.ZoneInfo[id=<span class="string">"CST"</span>,offset=-<span class="number">21600000</span>,dstSavings=<span class="number">3600000</span>,useDaylight=<span class="keyword">true</span>,transitions=<span class="number">235</span>,lastRule=java.util.SimpleTimeZone[id=CST,offset=-<span class="number">21600000</span>,dstSavings=<span class="number">3600000</span>,useDaylight=<span class="keyword">true</span>,startYear=<span class="number">0</span>,startMode=<span class="number">3</span>,startMonth=<span class="number">2</span>,startDay=<span class="number">8</span>,startDayOfWeek=<span class="number">1</span>,startTime=<span class="number">7200000</span>,startTimeMode=<span class="number">0</span>,endMode=<span class="number">3</span>,endMonth=<span class="number">10</span>,endDay=<span class="number">1</span>,endDayOfWeek=<span class="number">1</span>,endTime=<span class="number">7200000</span>,endTimeMode=<span class="number">0</span>]]</span><br></pre></td></tr></table></figure>

<p>这时，反而会有问题，相当于是 <code>UTC-6</code>（指定的Mysql Server会话时区） 转换为 <code>UTC+8</code> (客户端默认时区)</p>
<p>​                                        </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># JDBC 查询 TIMESTAMP 列的步骤</span></span><br><span class="line"></span><br><span class="line">1.</span><br><span class="line">默认的会话时区UTC+8</span><br><span class="line">2038-01-19 11:14:07</span><br><span class="line">Mysql服务器  ---------------------------------------------------------------------&gt; JDBC</span><br><span class="line"></span><br><span class="line"><span class="comment">### JDBC 拿到 TIMESTAMP 列的字节数组转为字符串是 ‘2038-01-19 11:14:07’， 所以第一步应该是这样的；而且改变全局 time_zone 变量，获取的字节数组也发送了变化</span></span><br><span class="line"><span class="comment">## SET GLOBAL time_zone = "+5:00";</span></span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">serverTimezone=CST	client默认时区=Asia/Shanghai</span><br><span class="line">2038-01-19 11:14:07（CST UTC-6）----&gt;  2038-01-20 13:14:07 (Asia/Shanghai UTC+8)</span><br><span class="line">JDBC------------------------------------------------------------------------------&gt; Java TimeStamp</span><br></pre></td></tr></table></figure>



<p>所以如果真的存在不同客户端时区问题，必要时修改 Mysql 的系统时区为含义明确的时区表示，而不是 <code>CST</code>, 客户端在使用的时候也不用指定 <code>useLegacyDatetimeCode=true&amp;useTimezone=true&amp;serverTimezone=时区</code>， 使用新的 <code>useLegacyDatetimeCode=false</code> 获取时区的方式就可以了，这种会查询 Mysql Server 的时区变量，作为 Server 的时区，因为会话默认也是取的系统时区，所以是一致的，没有什么问题。这时候会将正确的时间转换为客户端时区的时间。</p>
<p><code>TIMESTAMP</code> 操作真的是很麻烦了，必要时可以采用 <a href="https://www.liaoxuefeng.com/article/978494994163392" target="_blank" rel="noopener">廖雪峰-如何正确的处理时间</a> 中策略，存储成 <code>long</code> 型的时间偏移量就好多了，需要比较的话，直接比较的是整数，显示时，再指定特定时区，就可以了。 </p>

                
            </div>
        </article>
    
</div>
<div class="paginator">
    
        
        
        <a class="next" href="/page/2/">
            Next
            <i class="iconfont icon-next"></i>
        </a>
        
    
</div>

    </div>
</div>
<footer class="footer-social">
    

    

    

    <div class="footer-copyright">
        <p class="time-line">
            &copy;
            
            
            2020
            &nbsp;<i class="iconfont icon-heart"></i>&nbsp;
            <a target="_blank" href="https://github.com/iJinxin">Guo</a>
        </p>
        <p class="theme-info">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme -
            <a target="_blank" href="https://github.com/iJinxin/hexo-theme-sky">Sky</a>
        </p>
    </div>
</footer>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    

</script>
</html>
